# ─────────────────────────────────────────────────────────────────────
#  LogSentinel AI — Fluent Bit Custom Parsers
# ─────────────────────────────────────────────────────────────────────
#
#  These parsers supplement the built-in Fluent Bit parsers.
#  The syslog input plugin can use the built-in parsers directly
#  (syslog-rfc5424, syslog-rfc3164) — they are defined here as
#  overrides only if you need to customize them.
# ─────────────────────────────────────────────────────────────────────

# ── RFC 5424 (modern syslog) ──────────────────────────────────────
[PARSER]
    Name         syslog-rfc5424
    Format       regex
    Regex        ^\<(?<pri>[0-9]{1,5})\>1 (?<time>[^ ]+) (?<host>[^ ]+) (?<ident>[^ ]+) (?<pid>[-0-9]+) (?<msgid>[^ ]+) (?<extradata>(\[(.*?)\]|-)+) (?<message>.+)$
    Time_Key     time
    Time_Format  %Y-%m-%dT%H:%M:%S.%L%z
    Time_Keep    On

# ── RFC 3164 (legacy / BSD syslog) ────────────────────────────────
# Comma in ident class supports MikroTik comma-separated topics (e.g. wireless,info).
# (?:\:)? matches only an immediate colon after ident/PID — prevents eating
# message content when the message itself contains colons (e.g. MAC addresses).
[PARSER]
    Name         syslog-rfc3164
    Format       regex
    Regex        ^\<(?<pri>[0-9]+)\>(?<time>[^ ]* {1,2}[^ ]* [^ ]*) (?<host>[^ ]*) (?<ident>[a-zA-Z0-9_\/\.\-,]*)(?:\[(?<pid>[0-9]+)\])?(?:\:)? *(?<message>.+)$
    Time_Key     time
    Time_Format  %b %d %H:%M:%S
    Time_Keep    On

# ── RFC 3164 without PRI (some devices omit the priority) ─────────
[PARSER]
    Name         syslog-rfc3164-nopri
    Format       regex
    Regex        ^(?<time>[^ ]* {1,2}[^ ]* [^ ]*) (?<host>[^ ]*) (?<ident>[a-zA-Z0-9_\/\.\-,]*)(?:\[(?<pid>[0-9]+)\])?(?:\:)? *(?<message>.+)$
    Time_Key     time
    Time_Format  %b %d %H:%M:%S
    Time_Keep    On

# ── Cisco IOS / IOS-XE syslog ────────────────────────────────────
# Matches: <pri>seq: *timestamp: %FACILITY-SEV-MNEMONIC: message
# Also matches without PRI or without sequence number.
# Examples:
#   <189>115: *Mar  1 00:45:36.283: %SYS-5-CONFIG_I: Configured from console
#   <190>*Jan  2 13:28:05.323: %LINK-3-UPDOWN: Interface Gi0/1 changed state
[PARSER]
    Name         syslog-cisco-ios
    Format       regex
    Regex        ^\<(?<pri>[0-9]+)\>(?:(?<seq>[0-9]+): )?(?:\*?(?<time>[A-Z][a-z]{2} {1,2}[0-9]{1,2} [0-9]{2}:[0-9]{2}:[0-9]{2}(?:\.[0-9]+)?):? )?(?:%(?<facility>[A-Z0-9_]+)-(?<severity>[0-7])-(?<mnemonic>[A-Z0-9_]+): )?(?<message>.+)$
    Time_Key     time
    Time_Format  %b %d %H:%M:%S
    Time_Keep    On

# ── JSON (for structured log sources) ─────────────────────────────
[PARSER]
    Name         json
    Format       json
    Time_Key     timestamp
    Time_Format  %Y-%m-%dT%H:%M:%S.%L%z
    Time_Keep    On
